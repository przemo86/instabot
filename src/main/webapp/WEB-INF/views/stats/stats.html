<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:include="fragments/layout :: head">
    <title th:text="#{view.about.title}">Welcome!</title>
</head>
<body>
<div class="wrapper">
    <div th:replace="fragments/layout :: header"></div>
    <div class="page-content-wrapper">
        <div th:replace="fragments/layout :: upperBar"></div>
        <div class="container-fluid gradient-background">
            <p class="lead text-left site-title">
                Statystyki
            </p>
        </div>
        <span th:text="${project.name}"/>
        <canvas id="canvas" style="width: 100%; height: 500px;"></canvas>

        <script th:inline="javascript">
            var chartData = [[${chartData}]];
            var mylabels = [[${chartLabels}]];
            var chartLabels = [];
            mylabels.forEach(function (lbl) {
                chartLabels.push(new Date(lbl.split('###')[0]));
            });


            var ctx = $("#canvas")[0].getContext("2d");

            var myLineChart = new Chart(ctx, {
                type: "line",

                data: {
                    datasets: [
                        {
//                            steppedLine: 'before',
                            label: [[${project.name}]],
                            data: chartData,
                            borderColor: [[${chartColor}]],
                            fill: false
                        }
                    ],
                    labels: chartLabels
                },
                options: {
                    scales: {
                        xAxes: [
                            {
                                type: 'time',
                                time: {
                                    displayFormats: {
                                        second: 'YYYY/MMM HH:mm:ss'
                                    }
                                },
                                distribution: 'series',
                                position: "bottom",
                                ticks: {
                                    autoSkip: true,
                                    maxRotation: 90,
                                    minRotation: 90
                                }
                            }
                        ],
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Ilość trafień'
                                }
                            }
                        }]
                    }
                }
            });

            $("#canvas").click(
                function (evt) {
                    var activePoints = myLineChart.getElementsAtEvent(evt);
                    var statId = mylabels[activePoints[0]._index].split('###')[1];
                    //$.ajax.
                }
            );
        </script>

        <div th:replace="fragments/layout :: footer"></div>
    </div>

</div>
</body>
</html>